{% extends "grid_v2.html" %}
{% load i18n %}
{% block title %}Admin - Profitability Graph - Admin Portal{% endblock %}
{% block grid_content %}
	<div id="content-main">
		<h1>Profitability Graph</h1>
		<a href="/adminmng/report/profitability/">[Report]</a>
		<table>
			<tr>
				<td style="vertical-align: middle;">From Date:</td>
				<td style="vertical-align: middle;"><input type="text" id="id_txt_from_date"/></td>
				<td style="vertical-align: middle;">Number of Cycle:</td>
				<td style="vertical-align: middle;"><input type="text" id="id_txt_cycle" value="30"/></td>
				<td style="vertical-align: middle;">Cycle Type:</td>
				<td style="vertical-align: middle;">
					<select id="id_cbo_cycle">
						<option value="0">Daily</option>
						<option value="1">Weekly</option>
						<option value="2">Monthly</option>
					</select>
				</td>
				<td style="vertical-align: middle;">View Type:</td>
				<td style="vertical-align: middle;">
					<select id="id_cbo_type">
						<option value="TotalCalls">Total Calls</option>
						<option value="Duration">Duration</option>
						<option value="Acd">ACD</option>
						<option value="Charge">Charge</option>
						<option value="InboundCost">Inbound Cost</option>
						<option value="Cost">Wholesale Cost</option>
						<option value="Profit" selected="selected">Profit</option>
						<option value="ProfitRate">Profit Rate</option>
					</select>
				</td>
				<td style="width:800px">
					<input type="button" id="id_btn_refresh" value=" Refresh "/>
					<input type="button" id="id_btn_clear" value=" Clear "></input>
				</td>
			</tr>
		</table>
		<table style="width:100%">
			<tr>
				<td>
					<span>Labels:</span><br/>
					<select style="width: 250px; height:150px;" id="id_lst_lbl" multiple="multiple">
						{% for item in labels %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
				<td rowspan="5">
					{% include "admin_site/report/profitability_graph_chart.html" %}
				</td>
			</tr>
			<tr>
				<td>
					<span>Destination Codes:</span><br/>
					<select style="width: 250px; height:150px;" id="id_lst_destcode" multiple="multiple">
						{% for item in destcodes %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
			<tr>
				<td>
					<span>Inbound Carriers:</span><br/>
					<select style="width: 250px; height:120px;" id="id_lst_inbound" multiple="multiple">
						{% for item in inbounds %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
			<tr>
				<td>
					<span>Locations:</span><br/>
					<select style="width: 250px; height:150px;" id="id_lst_location" multiple="multiple">
						{% for item in countries %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
			<tr>
				<td>
					<span>Types:</span><br/>
					<select style="width: 250px; height:50px;" id="id_lst_type" multiple="multiple">
						{% for item in types %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
		</table>
	</div>
	
	<script src="/media/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"> </script>
	<script type="text/javascript">
		initializeControl();
	
		$("#id_btn_clear").click(function() {
			$("#id_lst_lbl option").attr("selected", false);
			$("#id_lst_destcode option").attr("selected", false);
			$("#id_lst_inbound option").attr("selected", false);
			$("#id_lst_location option").attr("selected", false);
			$("#id_lst_type option").attr("selected", false);
		});

		$("#id_btn_refresh").click(function() {
			refresh();
		});

		function initializeControl() {
			var now = new Date();
			var yesterday = now; 
			yesterday.setDate(now.getDate() - 30);
			
			jQuery("#id_txt_from_date").datepicker({
		        dateFormat: 'MM dd, yy',
		        clickInput: true,
		        createButton: false,
		    }).datepicker('setDate', yesterday);

			refresh();
		}

		function refresh() {
			var lbl_ids = '';
			var lbl_names = '';
			$("#id_lst_lbl option:selected").each(function() {
				lbl_ids += ($(this).val() + '+');
				lbl_names += ($(this).text() + '+');
			});

			var destcode_ids = '';
			var destcode_names = '';  
			$("#id_lst_destcode option:selected").each(function() {
				destcode_ids += ($(this).val() + '+');
				destcode_names += ($(this).text() + '+');
			});

			var inbound_ids = ''; 
			var inbound_names = '';
			$("#id_lst_inbound option:selected").each(function() {
				inbound_ids += ($(this).val() + '+');
				inbound_names += ($(this).text() + '+');
			});

			var location_ids = ''; 
			var location_names = '';
			$("#id_lst_location option:selected").each(function() {
				location_ids += ($(this).val() + '+');
				location_names += ($(this).text() + '+');
			});

			var type_ids = '';
			var type_names = '';
			$("#id_lst_type option:selected").each(function() {
				type_ids += ($(this).val() + '+');
				type_names += ($(this).text() + '+');
			});
			
			var params = {from_date: fromUIDate(jQuery("#id_txt_from_date").datepicker('getDate')),
							cycle_number: jQuery("#id_txt_cycle").val(),
							cycle_type: jQuery("#id_cbo_cycle").val(),
							viewtype: jQuery("#id_cbo_type").val(),
							label: lbl_ids,
							labelname: lbl_names,
							destcode: destcode_ids,
							destcodename: destcode_names,
							inbound: inbound_ids,
							inboundname: inbound_names,
							location: location_ids,
							locationname: location_names,
							type: type_ids,
							typename: type_names,};
			
			DoJSONPost("/adminmng/report/profitability/json/profitabilitychart/", params, function(data) {
				renderChart(data);
			}, null);
		}
	</script>
{% endblock %}