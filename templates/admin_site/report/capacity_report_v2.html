{% extends "grid_v2.html" %}
{% load i18n %}
{% block title %}Admin - Capacity Report V2 - Admin Portal{% endblock %}
{% block grid_content %}
	<div id="content-main">
		<h1>Capacity Report</h1>
		<div>
			From: <input type="text" value="" name="from" id="id_txt_from"/> 
			To: <input type="text" value="" name="to" id="id_txt_to"/>
			<input type="button" id="id_btn_create" value=" Refresh "></input>
			<input type="button" id="id_btn_clear" value=" Clear "></input>
		</div>
		<table style="width:100%">
			<tr>
				<td>
					<span>Inbounds:</span><br/>
					<select multiple="multiple" 
						style="width: 250px; height:120px;" id="id_lst_inbound">
						{% for item in inbounds %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
				<td rowspan="5">
					{% include "admin_site/report/capacity_report_chart.html" %}
				</td>
			</tr>
			<tr>
                <td>
                    <span>Rate Centers:</span><br/>
                    <select multiple="multiple" 
                        style="width: 250px; height:110px;" id="id_lst_ratecenter">
                        {% for item in ratecenters %}
                        <option value="{{ item.0 }}">{{ item.1 }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
			<tr>
				<td>
					<span>Gateways:</span><br/>
					<select multiple="multiple" 
						style="width: 250px; height:110px;" id="id_lst_gateway">
						{% for item in gateways %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
			<tr>
				<td>
					<span>Labels:</span><br/>
					<select multiple="multiple" 
						style="width: 250px; height:160px;" id="id_lst_label">
						{% for item in labels %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
			<tr>
                <td>
                    <span>Product Types:</span><br/>
                    <select multiple="multiple" 
                        style="width: 250px; height:110px;" id="id_lst_service">
                        {% for item in services %}
                        <option value="{{ item.0 }}">{{ item.1 }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
			<tr>
                <td>
                    <span>Outbounds:</span><br/>
                    <select multiple="multiple" 
                        style="width: 250px; height:110px;" id="id_lst_outbound">
                        {% for item in outbounds %}
                        <option value="{{ item.0 }}">{{ item.1 }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
			<tr>
				<td>
					<span>Destination Codes:</span><br/>
					<select multiple="multiple" 
						style="width: 250px; height:160px;" id="id_lst_destcode">
						{% for item in destcodes %}
						<option value="{{ item.0 }}">{{ item.1 }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
		</table>		
	</div>
	
	<script src="/media/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"> </script>
	
	<script type="text/javascript">
		initialize();
		initializeControl();
		//window.setInterval(initialize, 300000);

		$("#id_btn_create").click(function() {
			initialize();
		});

		$("#id_btn_clear").click(function() {
			$("#id_lst_inbound option").attr("selected", false);
			$("#id_lst_ratecenter option").attr("selected", false);
			$("#id_lst_gateway option").attr("selected", false);
			$("#id_lst_outbound option").attr("selected", false);
			$("#id_lst_label option").attr("selected", false);
			$("#id_lst_service option").attr("selected", false);
			$("#id_lst_destcode option").attr("selected", false);
		});

		function initializeControl() {
			jQuery("#id_txt_from").datepicker({
		        dateFormat: 'MM dd, yy',
		        clickInput: true,
		        createButton: false,
		    });

		    jQuery("#id_txt_to").datepicker({
		        dateFormat: 'MM dd, yy',
		        clickInput: true,
		        createButton: false,
		    });
		}

		function initialize() {
			var inbound_ids = '';
			var inbound_names = '';
			$("#id_lst_inbound option:selected").each(function() {
				inbound_ids += ($(this).val() + '+');
				inbound_names += ($(this).text() + '+');
			});
			
			var ratecenter_ids = '';
            var ratecenter_names = '';
            $("#id_lst_ratecenter option:selected").each(function() {
            	ratecenter_ids += ($(this).val() + '+');
            	ratecenter_names += ($(this).text() + '+');
            });

			var gateway_ids = '';
			var gateway_names = '';  
			$("#id_lst_gateway option:selected").each(function() {
				gateway_ids += ($(this).val() + '+');
				gateway_names += ($(this).text() + '+');
			});

			var outbound_ids = ''; 
			var outbound_names = '';
			$("#id_lst_outbound option:selected").each(function() {
				outbound_ids += ($(this).val() + '+');
				outbound_names += ($(this).text() + '+');
			});

			var label_ids = '';
			var label_names = '';
			$("#id_lst_label option:selected").each(function() {
				label_ids += ($(this).val() + '+');
				label_names += ($(this).text() + '+');
			});
			
			var service_ids = '';
            var service_names = '';
            $("#id_lst_service option:selected").each(function() {
                service_ids += ($(this).val() + '+');
                service_names += ($(this).text() + '+');
            });

			var destcode_ids = ''; 
			var destcode_names = '';
			$("#id_lst_destcode option:selected").each(function() {
				destcode_ids += ($(this).val() + '+');
				destcode_names += ($(this).text() + '+');
			});
			
			var params = {from: fromUIDate(jQuery("#id_txt_from").datepicker('getDate')),
							to: fromUIDate(jQuery("#id_txt_to").datepicker('getDate')),
							inbound: inbound_ids,
							inboundname: inbound_names,
							ratecenter: ratecenter_ids,
							ratecentername: ratecenter_names,
							gateway: gateway_ids,
							gatewayname: gateway_names,
							outbound: outbound_ids,
							outboundname: outbound_names,
							label: label_ids,
							labelname: label_names,
							service: service_ids,
							servicename: service_names,
							destcode: destcode_ids,
							destcodename: destcode_names};
			
			DoJSONPost("/adminmng/report/capacity-v2/json/get-capacity-report-v2/", params, function(data) {
				renderChart(data);
			}, null);
		}
	</script>
	
{% endblock %}