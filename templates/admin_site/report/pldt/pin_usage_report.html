{% extends "grid_v2.html" %}
{% load i18n %}
{% block title %}Unlimited Plan - PIN Usage Report - Admin Portal{% endblock %}
{% block page_title %}{% trans 'Unlimited Plan - PIN Usage Report' %}{% endblock %}
{% block grid_content %}
	<div id="content-main">
		<h1>PIN Usage Report</h1>
		<table>
			<tr>
				<td style="vertical-align: middle;">From:</td>
				<td style="vertical-align: middle;">
					<input type="text" value="" name="from" id="id_from"/>
				</td>
				<td style="vertical-align: middle;">To:</td>
				<td style="vertical-align: middle;">
					<input type="text" value="" name="to" id="id_to"/>
				</td>
				<td style="vertical-align: middle;">Label:</td>
				<td>
					<select name="label" id="label">
					   <option value="">ALL</option>
					   {% for label in label_groups %}
                           <option value="{{label.0}}">{{label.1}}</option>
                       {% endfor %}
					</select>
				</td>
				<td>
					<input type="button" value=" Filter " id="id_btn_filter"/>
				</td>
			</tr>
		</table>
		{% include "admin_site/report/pldt/pin_usage_report_chart.html" %}
		<table style="display: none;">
        	<tr>
        		<td style="background-color: #E7E7E7"><span style="font-size:10pt">Total Used: </span></td>
        		<td style="width:100px; text-align: right;"><span id="id_a_totalused" style="font-size:10pt; font-weight:bold;"></span></td>
        	</tr>
        </table>
        <input type="button" id="btnExportToCsv" value="Export to Excel" />
        <input type="button" id="btnExportToReport" value="Export to Report" />
        <br />
	    <table id="rowed1" width="100%" height="100%"></table>
		<div id="prowed1"></div>
	</div>
	
	<script src="/media/js/jquery-ui-1.8.16.custom.min.js" type="text/javascript"> </script>
	<script src="/media/js/jquery.tools.min.js" type="text/javascript"> </script>
	<script src="/media/jqgrid/admin_site/report/pldt/pinusagerpt.js" type="text/javascript"> </script>
	
	<script type="text/javascript">
		
		initialize();
		loadDetail();
		
		jQuery("#id_btn_filter").click(function () {
			var date_from = fromUIDate(jQuery("#id_from").datepicker('getDate'))
			if (date_from == ''){
	        	showAlertMsg("Please select from date", true);
	        	$("#id_from").focus()
	        	return false;
	        }
			
	        var date_to = fromUIDate(jQuery("#id_to").datepicker('getDate'))
	        if (date_to == ''){
	        	showAlertMsg("Please select to date", true);
	        	$("#id_to").focus()
	        	return false;
	        }
	        
			if (validateDate('MM dd, yy')){
		        reloadGrid("#rowed1");
		        loadDetail();
	    	}
	    });

	    function loadDetail() {
	    	var date_from = fromUIDate(jQuery("#id_from").datepicker('getDate'))
	        var date_to = fromUIDate(jQuery("#id_to").datepicker('getDate'))
	        
	        jQuery.getJSON("json/pinusagedetail/?from=" + date_from + "&to=" + date_to, function(data) {
	    		if (data.ErrorCode == 0) {
	    			$("#id_a_totalused").html(data.TotalUsed);
	    			renderChart(data);
	    		}
	    	});
	    }

	    function initialize() {
	    	var now = new Date();
	    	var lastWeek = now;
	    	lastWeek.setDate(now.getDate() - 7);
	    	
	    	jQuery("#id_from").datepicker({
	            dateFormat: 'MM dd, yy',
	            clickInput: true,
	            createButton: false,
	        }).datepicker('setDate', lastWeek);

	        jQuery("#id_to").datepicker({
	            dateFormat: 'MM dd, yy',
	            clickInput: true,
	            createButton: false,
	        }).datepicker('setDate', new Date());
	    }
	</script>
{% endblock %}